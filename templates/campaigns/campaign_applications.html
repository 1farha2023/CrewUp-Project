{% extends 'base.html' %}
{% load static %}

{% block title %}{{ campaign.title }} - Applications{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 pt-20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">{{ campaign.title }} - Applications</h1>
                    <p class="mt-2 text-gray-600">Manage applications from influencers</p>
                </div>
                <a href="{% url 'campaigns:campaign_detail' campaign.id %}"
                   class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                    Back to Campaign
                </a>
            </div>
        </div>

        <!-- Campaign Summary -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="flex items-center space-x-4">
                {% if campaign.image %}
                <img src="{{ campaign.image.url }}" alt="{{ campaign.title }}" class="w-16 h-16 object-cover rounded-lg">
                {% else %}
                <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center">
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                {% endif %}
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">{{ campaign.title }}</h2>
                    <p class="text-gray-600">{{ campaign.description|truncatechars:100 }}</p>
                    <div class="flex items-center space-x-4 mt-2">
                        <span class="text-sm text-gray-500">${{ campaign.budget }}</span>
                        <span class="text-sm text-gray-500">{{ campaign.category }}</span>
                        <span class="text-sm text-gray-500">{{ campaign.platform }}</span>
                        <span class="text-sm text-purple-600 font-medium">{{ applications.count }} applications</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Applications List -->
        <div class="bg-white rounded-lg shadow-sm">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-medium text-gray-900">Applications ({{ applications.count }})</h2>
            </div>
            <div class="divide-y divide-gray-200">
                {% for application in applications %}
                <div class="p-6">
                    <div class="flex items-start justify-between">
                        <div class="flex items-start space-x-4">
                            {% if application.influencer.profile_picture %}
                            <img src="{{ application.influencer.profile_picture.url }}" alt="{{ application.influencer.username }}" class="w-12 h-12 rounded-full object-cover">
                            {% else %}
                            <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center">
                                <span class="text-gray-600 font-medium">{{ application.influencer.username.0|upper }}</span>
                            </div>
                            {% endif %}
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h3 class="text-lg font-medium text-gray-900">{{ application.influencer.username }}</h3>
                                    {% if application.influencer.get_full_name %}
                                    <span class="text-gray-500">({{ application.influencer.get_full_name }})</span>
                                    {% endif %}
                                </div>

                                {% if application.influencer.niche %}
                                <p class="text-sm text-purple-600 mb-2">{{ application.influencer.niche }}</p>
                                {% endif %}

                                <div class="flex items-center space-x-4 text-sm text-gray-500 mb-3">
                                    {% if application.influencer.followers_count %}
                                    <span>{{ application.influencer.followers_count|default:0 }} followers</span>
                                    {% endif %}
                                    {% if application.influencer.location %}
                                    <span>{{ application.influencer.location }}</span>
                                    {% endif %}
                                    <span>Applied {{ application.applied_at|date:"M j, Y" }}</span>
                                </div>

                                {% if application.application_message %}
                                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                    <h4 class="text-sm font-medium text-gray-900 mb-2">Application Message:</h4>
                                    <p class="text-sm text-gray-700">{{ application.application_message }}</p>
                                </div>
                                {% endif %}

                                <!-- Influencer Social Links -->
                                <div class="flex items-center space-x-3">
                                    {% if application.influencer.instagram_handle %}
                                    <a href="https://instagram.com/{{ application.influencer.instagram_handle|cut:'@' }}"
                                       target="_blank"
                                       class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-pink-100 text-pink-800 hover:bg-pink-200">
                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.097.118.112.221.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.624 0 11.99-5.367 11.99-11.987C24.007 5.367 18.641.001 12.017.001z"/>
                                        </svg>
                                        Instagram
                                    </a>
                                    {% endif %}

                                    {% if application.influencer.youtube_channel %}
                                    <a href="{{ application.influencer.youtube_channel }}"
                                       target="_blank"
                                       class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 hover:bg-red-200">
                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                                        </svg>
                                        YouTube
                                    </a>
                                    {% endif %}

                                    {% if application.influencer.tiktok_handle %}
                                    <a href="https://tiktok.com/@{{ application.influencer.tiktok_handle|cut:'@' }}"
                                       target="_blank"
                                       class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-black text-white hover:bg-gray-800">
                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-.88-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                                        </svg>
                                        TikTok
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Application Status and Actions -->
                        <div class="flex items-center space-x-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if application.status == 'pending' %}bg-yellow-100 text-yellow-800
                                {% elif application.status == 'approved' %}bg-green-100 text-green-800
                                {% elif application.status == 'rejected' %}bg-red-100 text-red-800
                                {% else %}bg-blue-100 text-blue-800{% endif %}">
                                {{ application.get_status_display }}
                            </span>

                            {% if application.status == 'pending' %}
                            <div class="flex space-x-2">
                                <form method="post" action="{% url 'campaigns:approve_application' application.id %}" class="inline">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">
                                        Approve
                                    </button>
                                </form>
                                <form method="post" action="{% url 'campaigns:reject_application' application.id %}" class="inline">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                        Reject
                                    </button>
                                </form>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="p-12 text-center">
                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">No applications yet</h3>
                    <p class="text-gray-500">Share your campaign to attract influencers!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}